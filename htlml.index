<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Shop Express - Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles communs pour tous les fichiers */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --sidebar-width: 260px;
            --header-height: 60px;
            --sidebar-bg: #111827;
            --sidebar-hover: #1f2937;
            --text-light: #f3f4f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #f8fafc;
            display: flex;
        }

        /* Sidebar styles */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--sidebar-bg);
            position: fixed;
            left: 0;
            top: 0;
            color: var(--text-light);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }
        
        .sidebar-content {
            position: relative;
            height: 100%;
        }
        
        .logo {
            padding: 1.5rem;
            background: var(--primary-dark);
            height: var(--header-height);
            display: flex;
            align-items: center;
        }
        
        .menu-items {
            list-style: none;
            padding: 1rem 0;
        }
        
        .menu-items li a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .menu-items li a:hover {
            background: var(--sidebar-hover);
            color: var(--primary-light);
        }
        
        .menu-items li a i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        .tech-lines-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 120px);
            overflow: hidden;
            pointer-events: none;
            z-index: -1;
        }
        
        /* Main content styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            min-height: 100vh;
        }

        .mobile-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            margin-bottom: 1rem;
            color: var(--sidebar-bg);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .mobile-toggle {
                display: block;
            }
        }

        /* Dashboard cards styles */
        .cards-row { display:flex; gap:16px; flex-wrap:wrap; margin:18px 0; }
        .card-mini {
            flex:1 1 220px;
            background:linear-gradient(135deg,#fff,#f7f9fc);
            border-radius:12px;
            padding:18px;
            box-shadow:0 6px 18px rgba(0,0,0,0.06);
            display:flex;align-items:center;gap:12px;
        }
        .card-mini .icon { font-size:28px; width:56px; height:56px; border-radius:10px; display:flex;align-items:center;justify-content:center; }
        .card-mini .body { flex:1 }
        .card-mini h3 { margin:0; font-size:20px }
        .card-mini p { margin:4px 0 0;color:#6b7280 }
        .emoji-sticker { font-size:26px }
        .dashboard-table { margin-top:18px; border-radius:8px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        .dashboard-table table { width:100%; border-collapse:collapse; }
        .dashboard-table thead { background:#111827; color:#fff }
        .dashboard-table th, .dashboard-table td { padding:10px 12px; border-bottom:1px solid #e6eef8; text-align:left }
        .small-muted { color:#6b7280; font-size:13px }
        .count { font-weight:700; font-size:22px }
        .refresh-btn { cursor:pointer; color:#2563eb; font-weight:600 }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-content">
            <div class="logo">
                <h1><i class="fas fa-shop"></i> DSE Manager</h1>
            </div>
            <ul class="menu-items">
                <li><a href="index.html" class="active"><i class="fas fa-home"></i> Tableau de bord</a></li>
                <li><a href="gestion-clients.html"><i class="fas fa-users"></i> Gestion Clients</a></li>
                <li><a href="parametres.html"><i class="fas fa-cog"></i> Param√®tres</a></li>
                <li><a href="notification.html"><i class="fas fa-bell"></i> Notifications</a></li>
            </ul>
            <div class="tech-lines-container" id="tech-lines-container"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="mobile-toggle">
            <i class="fas fa-bars"></i>
        </div>
        
        <h1>Bienvenue sur Digital Shop Express Manager</h1>
        <div class="dashboard-content">
            <!-- Dashboard: cartes dynamiques et tableau annuel -->
            <div class="cards-row" id="dashboardCards">
                <div class="card-mini" style="--accent:#10b981">
                    <div class="icon" style="background:linear-gradient(135deg,#d1fae5,#10b981); color:#065f46">üìã</div>
                    <div class="body">
                        <h3><span class="count" id="totalClients">0</span> <span class="small-muted">clients</span></h3>
                        <p class="small-muted">Total clients enregistr√©s <span class="emoji-sticker">üë•</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#f59e0b">
                    <div class="icon" style="background:linear-gradient(135deg,#fff7ed,#f59e0b); color:#7c2d12">‚ö†Ô∏è</div>
                    <div class="body">
                        <h3><span class="count" id="inactiveClients">0</span> <span class="small-muted">inactifs</span></h3>
                        <p class="small-muted">Clients inactifs / expir√©s <span class="emoji-sticker">üõë</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#3b82f6">
                    <div class="icon" style="background:linear-gradient(135deg,#dbecff,#3b82f6); color:#052f66">üí∞</div>
                    <div class="body">
                        <h3><span class="count" id="annualSum">0</span> <span class="small-muted">FCFA</span></h3>
                        <p class="small-muted">Somme annuelle estim√©e <span class="emoji-sticker">üìà</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#8b5cf6">
                    <div class="icon" style="background:linear-gradient(135deg,#f3e8ff,#8b5cf6); color:#3c1361">‚ú®</div>
                    <div class="body">
                        <h3><span class="count" id="thisYearClients">0</span> <span class="small-muted">cette ann√©e</span></h3>
                        <p class="small-muted">Nouveaux / renouvellements <span class="emoji-sticker">üéâ</span></p>
                    </div>
                </div>
                <!-- Nouveaux KPI ETVPro et alertes -->
                <div class="card-mini" style="--accent:#06b6d4">
                    <div class="icon" style="background:linear-gradient(135deg,#e6f9fb,#06b6d4); color:#064e63">‚úÖ</div>
                    <div class="body">
                        <h3><span class="count" id="activeClients">0</span> <span class="small-muted">actifs</span></h3>
                        <p class="small-muted">Clients actuellement actifs <span class="emoji-sticker">üîî</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#ef4444">
                    <div class="icon" style="background:linear-gradient(135deg,#ffecec,#ef4444); color:#6b0b0b">‚è≥</div>
                    <div class="body">
                        <h3><span class="count" id="expiringSoon">0</span> <span class="small-muted">fin dans 5j</span></h3>
                        <p class="small-muted">Abonnements expirant sous 5 jours <span class="emoji-sticker">‚ö†Ô∏è</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#f97316">
                    <div class="icon" style="background:linear-gradient(135deg,#fff4e6,#f97316); color:#7a2e0b">üì∫</div>
                    <div class="body">
                        <h3><span class="count" id="totalETVPro">0</span> <span class="small-muted">ETVPro</span></h3>
                        <p class="small-muted">Clients disposant d'un code ETVPro <span class="emoji-sticker">üì¶</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#ef9a9a">
                    <div class="icon" style="background:linear-gradient(135deg,#fff1f1,#ef9a9a); color:#6b0b0b">üö´</div>
                    <div class="body">
                        <h3><span class="count" id="inactiveETVPro">0</span> <span class="small-muted">inactifs ETVPro</span></h3>
                        <p class="small-muted">Codes ETVPro inactifs <span class="emoji-sticker">üîí</span></p>
                    </div>
                </div>

                <div class="card-mini" style="--accent:#60a5fa">
                    <div class="icon" style="background:linear-gradient(135deg,#eaf2ff,#60a5fa); color:#08306b">üéØ</div>
                    <div class="body">
                        <h3><span class="count" id="activeETVPro">0</span> <span class="small-muted">actifs ETVPro</span></h3>
                        <p class="small-muted">Clients ETVPro encore actifs <span class="emoji-sticker">üè∑Ô∏è</span></p>
                    </div>
                </div>
            </div>

            <div class="dashboard-table">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#111827;color:#fff">
                    <div><strong>Statistiques des plateformes</strong> <span class="small-muted">(ventes)</span></div>
                    <div style="display:flex;gap:12px;align-items:center">
                        <div class="refresh-btn" id="refreshDashboard">üîÑ Rafra√Æchir</div>
                    </div>
                </div>
                <table id="streamingStatsTable">
                    <thead>
                        <tr>
                            <th>Plateforme</th>
                            <th>Clients actifs</th>
                            <th>Total clients</th>
                            <th>Revenu mensuel</th>
                            <th>% du total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Remplissage dynamique -->
                    </tbody>
                    <tfoot>
                        <tr style="font-weight:600;background:#f8fafc">
                            <td>Total</td>
                            <td id="totalActiveClients">-</td>
                            <td id="totalAllClients">-</td>
                            <td id="totalRevenue">-</td>
                            <td>100%</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // Cr√©ation des lignes technologiques anim√©es
        function createTechLine() {
            const container = document.getElementById('tech-lines-container');
            if (!container) return;
            
            const line = document.createElement('div');
            line.className = 'tech-line';
            line.style.left = Math.random() * 100 + '%';
            line.style.animationDuration = (Math.random() * 3 + 2) + 's';
            line.style.opacity = Math.random() * 0.5 + 0.3;
            container.appendChild(line);
            
            // Supprimer la ligne apr√®s l'animation
            setTimeout(() => {
                if (line.parentNode) {
                    line.parentNode.removeChild(line);
                }
            }, 5000);
        }

        // Cr√©er plusieurs lignes pour un meilleur effet
        document.addEventListener('DOMContentLoaded', function() {
            // Cr√©er des lignes initiales
            for (let i = 0; i < 15; i++) { 
                setTimeout(createTechLine, Math.random() * 2000); 
            }
            
            // Continuer √† cr√©er des lignes p√©riodiquement
            setInterval(createTechLine, 300);
        });
    </script>
    
    <style>
        .tech-line {
            position: absolute;
            top: 100%;
            width: 2px;
            height: 60px; /* Longueur r√©duite des lignes */
            background: rgba(0, 255, 229, 0.7);
            animation: moveUp 3s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes moveUp {
            from {
                transform: translateY(0);
                opacity: 0.7;
            }
            to {
                transform: translateY(-400px); /* Distance r√©duite */
                opacity: 0;
            }
        }
    </style>
    <script>
        // Dashboard dynamic population (reads clients from localStorage)
        function parseMontant(m) {
            if (!m) return 0;
            // remove non digits
            const digits = String(m).replace(/[^0-9]/g, '');
            return digits ? parseInt(digits, 10) : 0;
        }

        function animateCount(el, target) {
            const start = 0;
            const duration = 600;
            const startTime = performance.now();
            function frame(now) {
                const progress = Math.min((now - startTime) / duration, 1);
                const value = Math.floor(start + (target - start) * progress);
                el.textContent = value.toLocaleString('fr-FR');
                if (progress < 1) requestAnimationFrame(frame);
            }
            requestAnimationFrame(frame);
        }

        function updateDashboard() {
            const raw = localStorage.getItem('clientsData');
            let clients = [];
            try { clients = raw ? JSON.parse(raw) : []; } catch(e) { clients = []; }

            const total = clients.length;
            const inactive = clients.filter(c => c.statut && c.statut !== 'Actif').length;

            const now = new Date();
            const year = now.getFullYear();

            const yearClients = clients.filter(c => {
                if (!c.date_expiration) return false;
                const d = new Date(c.date_expiration);
                return d.getFullYear() === year;
            });

            // Somme annuelle: sum des montants des clients dont la date_expiration est cette ann√©e
            const sum = yearClients.reduce((acc, c) => acc + parseMontant(c.montant), 0);

            // Clients actifs
            const activeCount = clients.filter(c => c.statut === 'Actif').length;

            // Expirant dans 5 jours (y compris aujourd'hui)
            const inFiveDays = clients.filter(c => {
                if (!c.date_expiration) return false;
                const d = new Date(c.date_expiration);
                const diff = (d.setHours(0,0,0,0) - new Date().setHours(0,0,0,0)) / (1000*60*60*24);
                return diff >= 0 && diff <= 5;
            }).length;

            // ETVPro counts: client total, inactive, actif
            const hasETV = clients.filter(c => c.code_etvpro && String(c.code_etvpro).trim() !== '');
            const totalETVPro = hasETV.length;
            const inactiveETVPro = hasETV.filter(c => c.statut !== 'Actif').length;
            const activeETVPro = hasETV.filter(c => c.statut === 'Actif').length;

            // Render counts
            const totalEl = document.getElementById('totalClients');
            const inactiveEl = document.getElementById('inactiveClients');
            const annualEl = document.getElementById('annualSum');
            const thisYearEl = document.getElementById('thisYearClients');

            animateCount(totalEl, total);
            animateCount(inactiveEl, inactive);
            animateCount(annualEl, sum);
            animateCount(thisYearEl, yearClients.length);

            // animate new counts
            const activeEl = document.getElementById('activeClients');
            const expiringEl = document.getElementById('expiringSoon');
            const totalEtvEl = document.getElementById('totalETVPro');
            const inactiveEtvEl = document.getElementById('inactiveETVPro');
            const activeEtvEl = document.getElementById('activeETVPro');

            animateCount(activeEl, activeCount);
            animateCount(expiringEl, inFiveDays);
            animateCount(totalEtvEl, totalETVPro);
            animateCount(inactiveEtvEl, inactiveETVPro);
            animateCount(activeEtvEl, activeETVPro);

            // Calcul et affichage des statistiques de streaming
            const tbody = document.querySelector('#streamingStatsTable tbody');
            tbody.innerHTML = '';

            // Regrouper les clients par plateforme
            const platformStats = {};
            clients.forEach(client => {
                const platform = (client.plateforme || 'Non sp√©cifi√©').trim();
                if (!platformStats[platform]) {
                    platformStats[platform] = {
                        total: 0,
                        active: 0,
                        revenue: 0
                    };
                }
                platformStats[platform].total++;
                if (client.statut === 'Actif') {
                    platformStats[platform].active++;
                    platformStats[platform].revenue += parseMontant(client.montant);
                }
            });

            // Calculer les totaux
            let totalActive = 0;
            let totalClients = 0;
            let totalRevenue = 0;
            Object.values(platformStats).forEach(stats => {
                totalActive += stats.active;
                totalClients += stats.total;
                totalRevenue += stats.revenue;
            });

            // Trier les plateformes par revenu
            const sortedPlatforms = Object.entries(platformStats)
                .sort(([,a], [,b]) => b.revenue - a.revenue);

            // Remplir le tableau
            sortedPlatforms.forEach(([platform, stats]) => {
                const tr = document.createElement('tr');
                const percentage = totalRevenue ? ((stats.revenue / totalRevenue) * 100).toFixed(1) : '0.0';
                tr.innerHTML = `
                    <td><strong>${platform}</strong></td>
                    <td>${stats.active}</td>
                    <td>${stats.total}</td>
                    <td>${stats.revenue.toLocaleString('fr-FR')} FCFA</td>
                    <td>${percentage}%</td>
                `;
                tbody.appendChild(tr);
            });

            // Mettre √† jour les totaux
            document.getElementById('totalActiveClients').textContent = totalActive;
            document.getElementById('totalAllClients').textContent = totalClients;
            document.getElementById('totalRevenue').textContent = `${totalRevenue.toLocaleString('fr-FR')} FCFA`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            document.getElementById('refreshDashboard').addEventListener('click', updateDashboard);
        });
    </script>
</body>
</html> 
    
  
  
  
  
      

      

  
      
        
      
          
        

      
            
              

      
  
